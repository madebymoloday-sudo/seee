# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Webhook –æ—Ç Lava.top

## üìã –ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (–¥–ª—è –±—ã—Å—Ç—Ä–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)

### –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –≤ Lava.top:

1. **URL**: 
   ```
   https://seee-a.up.railway.app/api/lava/webhook
   ```
   (–∏–ª–∏ –≤–∞—à –¥–æ–º–µ–Ω, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –¥—Ä—É–≥–æ–π)

2. **–¢–∏–ø —Å–æ–±—ã—Ç–∏—è**: 
   ‚úÖ **"–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–ª–∞—Ç–µ–∂–∞"**

3. **–í–∏–¥ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏**: 
   ‚úÖ **"API key –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞"**
   
   **API –∫–ª—é—á:**
   ```
   OC6pdhrMu1iebGwFwqFuNqhq5gULHWkDv4ecWfglOt8xGi2udlhszLzc3eZRlG4o
   ```

4. **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π**: 
   ```
   –ü–æ–¥–ø–∏—Å–∫–∞ SEEE - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
   ```
   (–∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º)

5. –ù–∞–∂–º–∏—Ç–µ **"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"**

---

## üìñ –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Webhook

1. –í–æ–π–¥–∏—Ç–µ –≤ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç –Ω–∞ `app.lava.top`
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **"–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏"** (Integrations)
3. –ù–∞–∂–º–∏—Ç–µ **"–î–æ–±–∞–≤–∏—Ç—å Webhook"** (Add Webhook)

---

### –®–∞–≥ 2: –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É Webhook

#### 1. **URL** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ) ‚≠ê

–í—Å—Ç–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π URL:
```
https://seee-a.up.railway.app/api/lava/webhook
```

**–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –¥—Ä—É–≥–æ–π –¥–æ–º–µ–Ω:**
- –ó–∞–º–µ–Ω–∏—Ç–µ `seee-a.up.railway.app` –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS
- URL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞

‚ö†Ô∏è **–í–ê–ñ–ù–û:** 
- URL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ (–Ω–µ localhost)
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
- URL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ—á–Ω—ã–º, –±–µ–∑ –ª–∏—à–Ω–∏—Ö —Å–ª—ç—à–µ–π –≤ –∫–æ–Ω—Ü–µ

---

#### 2. **–¢–∏–ø —Å–æ–±—ã—Ç–∏—è** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ) ‚≠ê

–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞:

‚úÖ **"–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–ª–∞—Ç–µ–∂–∞"** (Payment result)

**–ü–æ—á–µ–º—É —ç—Ç–æ—Ç —Ç–∏–ø:**
- –≠—Ç–æ—Ç —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç–µ
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ —Ä–∞–∑–æ–≤—ã–µ –ø–ª–∞—Ç–µ–∂–∏, —Ç–∞–∫ –∏ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏
- –°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–ª–∞—Ç–µ–∂–µ

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã –æ–±–∞):**
- –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å **–¥–≤–∞ webhook**:
  1. "–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–ª–∞—Ç–µ–∂–∞" - –¥–ª—è —Ä–∞–∑–æ–≤—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π
  2. "–†–µ–≥—É–ª—è—Ä–Ω—ã–π –ø–ª–∞—Ç—ë–∂" - –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–¥–ª–µ–Ω–∏–π –ø–æ–¥–ø–∏—Å–∫–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ù–∞—á–Ω–∏—Ç–µ —Å **"–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–ª–∞—Ç–µ–∂–∞"**, —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –Ω–∞—á–∞–ª–∞.

---

#### 3. **–í–∏–¥ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è Webhook** ‚≠ê

–í—ã–±–µ—Ä–∏—Ç–µ:

‚úÖ **"API key –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞"** (API key of your service)

**–í –ø–æ–ª–µ API –∫–ª—é—á –≤—Å—Ç–∞–≤—å—Ç–µ:**
```
OC6pdhrMu1iebGwFwqFuNqhq5gULHWkDv4ecWfglOt8xGi2udlhszLzc3eZRlG4o
```

**–ü–æ—á–µ–º—É API key, –∞ –Ω–µ Basic:**
- –ë–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è
- –ü—Ä–æ—â–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ backend

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ (–µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ Basic):**
- –í—ã–±–µ—Ä–∏—Ç–µ **"Basic"**
- –õ–æ–≥–∏–Ω: `pavelgulo@yandex.ru` (–≤–∞—à email)
- –ü–∞—Ä–æ–ª—å: —Å–æ–∑–¥–∞–π—Ç–µ –Ω–∞–¥–µ–∂–Ω—ã–π –ø–∞—Ä–æ–ª—å (—Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ!)

---

#### 4. **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π** (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ)

–ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å:
```
–ü–æ–¥–ø–∏—Å–∫–∞ SEEE - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É
```

–ò–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º - —ç—Ç–æ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∞–±–æ—Ç—É.

---

### –®–∞–≥ 3: –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ Webhook

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –ø–æ–ª—è
2. –ù–∞–∂–º–∏—Ç–µ **"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"**
3. Lava.top –æ—Ç–ø—Ä–∞–≤–∏—Ç —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤–∞—à webhook URL

---

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Backend –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ Webhook

### 1. –î–æ–±–∞–≤—å—Ç–µ endpoint –≤ app.py

```python
@app.route('/api/lava/webhook', methods=['POST'])
def lava_webhook():
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ webhook –æ—Ç Lava.top"""
    try:
        data = request.json
        
        # –õ–æ–≥–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
        print(f"Webhook –æ—Ç Lava.top: {json.dumps(data, indent=2)}")
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∏–ø —Å–æ–±—ã—Ç–∏—è
        event_type = data.get('type')
        status = data.get('status')
        order_id = data.get('order_id')
        
        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —É—Å–ø–µ—à–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏
        if status == 'success' or status == 'paid':
            # –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            custom_fields = data.get('custom_fields', {})
            user_id = custom_fields.get('user_id')
            telegram = custom_fields.get('telegram')
            email = custom_fields.get('email')
            
            if user_id:
                # –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–æ–¥–ø–∏—Å–∫—É
                activate_subscription(user_id, duration_days=30)
                
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–Ω—Ç–∞–∫—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                if telegram or email:
                    save_user_contact_info(user_id, telegram, email)
                
                # –õ–æ–≥–∏—Ä—É–µ–º —É—Å–ø–µ—à–Ω—É—é –∞–∫—Ç–∏–≤–∞—Ü–∏—é
                print(f"–ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}")
        
        return jsonify({'status': 'ok'}), 200
        
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook: {e}")
        return jsonify({'error': str(e)}), 500
```

### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Basic auth, –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏:

```python
from flask import request

@app.route('/api/lava/webhook', methods=['POST'])
def lava_webhook():
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ Basic Auth
    auth = request.authorization
    if not auth or auth.username != 'your_email' or auth.password != 'your_password':
        return jsonify({'error': 'Unauthorized'}), 401
    
    # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
```

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ API key, –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫:

```python
api_key = request.headers.get('X-API-Key')
if api_key != LAVA_API_KEY:
    return jsonify({'error': 'Invalid API key'}), 401
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö Webhook

### –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –æ—Ç Lava.top:

```json
{
    "type": "payment",
    "status": "success",
    "order_id": "subscription_123_1234567890",
    "amount": 1000,
    "currency": "RUB",
    "custom_fields": {
        "user_id": "123",
        "telegram": "@username",
        "email": "user@example.com"
    },
    "timestamp": "2025-12-15T10:00:00Z"
}
```

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Webhook

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å URL

```bash
curl -X POST https://–≤–∞—à-–¥–æ–º–µ–Ω.com/api/lava/webhook \
  -H "Content-Type: application/json" \
  -d '{"test": true}'
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –æ—Ç–≤–µ—Ç (–¥–∞–∂–µ –µ—Å–ª–∏ –æ—à–∏–±–∫–∞, –≥–ª–∞–≤–Ω–æ–µ - —á—Ç–æ endpoint –¥–æ—Å—Ç—É–ø–µ–Ω).

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

–ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è webhook –≤ Lava.top, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ - –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–π—Ç–∏ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å.

### 3. –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂

–°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂ —á–µ—Ä–µ–∑ Lava.top –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ webhook —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç.

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS
2. ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø–æ–¥–ø–∏—Å—å/–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
3. ‚úÖ –í–∞–ª–∏–¥–∏—Ä—É–π—Ç–µ –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ
4. ‚úÖ –õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Å–µ webhook –∑–∞–ø—Ä–æ—Å—ã
5. ‚úÖ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏ gracefully

---

## –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø–ª–∞—Ç–µ–∂–∏ –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

