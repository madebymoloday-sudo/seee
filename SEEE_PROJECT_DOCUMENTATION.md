# SEEE - Документация проекта по этапам

## Описание проекта

**SEEE (Strong AI Thinking Architecture)** — это приложение, основанное на архитектуре мышления сильного ИИ. Мы описали, как устроено мышление человека, создали это для сильного ИИ, и теперь эта технология мышления доступна вам для перестройки собственного мышления.

**Концепция:** Мышление — это ваш дом. Если дом построен неудачно, вам будет холодно, тревожно и пусто. Этот дом не будет работать, поэтому сначала нужно создать план вашего дома — Нейрокарту. Затем разобрать ошибки, неровности и проблемы, которые вызывают дискомфорт. После этого перестроить дом так, чтобы вы начали жить и думать по-другому — формировать реалистичное позитивное мышление, понимать свои плюсы и минусы, принимать себя. С таким домом не страшны кризисы и трудные ситуации. С таким домом возможна счастливая и успешная жизнь.

---

## Этап 1: Аутентификация и регистрация пользователей

### Цель
Обеспечить безопасный вход пользователей в систему с поддержкой различных методов аутентификации.

### Функционал

#### 1.1. Регистрация через логин/пароль
- **Файл:** `templates/register.html`, `static/js/register.js`, `app.py` (route `/register`)
- **Цель:** Создание нового аккаунта с логином и паролем
- **Пример работы:**
  ```
  Пользователь вводит:
  - Логин: "user123"
  - Пароль: "securePass123"
  - Подтверждение пароля: "securePass123"
  
  Система:
  1. Проверяет уникальность логина
  2. Хеширует пароль (bcrypt)
  3. Создает запись в таблице users
  4. Генерирует referral_code
  5. Перенаправляет на главную страницу
  ```

#### 1.2. Вход через логин/пароль
- **Файл:** `templates/login.html`, `static/js/login.js`, `app.py` (route `/login`)
- **Цель:** Авторизация существующего пользователя
- **Пример работы:**
  ```
  Пользователь вводит:
  - Логин: "user123"
  - Пароль: "securePass123"
  
  Система:
  1. Проверяет существование пользователя
  2. Сравнивает хеш пароля
  3. Создает сессию Flask
  4. Перенаправляет на главную страницу
  ```

#### 1.3. Вход через Google OAuth
- **Файл:** `templates/login.html`, `static/js/login.js`, `app.py` (route `/api/auth/google`)
- **Цель:** Упрощенная авторизация через Google аккаунт
- **Пример работы:**
  ```
  Пользователь:
  1. Нажимает "Войти через Google"
  2. Выбирает Google аккаунт
  3. Разрешает доступ приложению
  
  Система:
  1. Получает ID токен от Google
  2. Извлекает email, имя, google_id
  3. Ищет пользователя по google_id или email
  4. Если не найден - создает нового
  5. Создает сессию Flask
  6. Перенаправляет на главную страницу
  ```

#### 1.4. Восстановление пароля (структура)
- **Файл:** `app.py` (route `/api/cabinet/security/email`)
- **Цель:** Позволить пользователю восстановить пароль через email
- **Статус:** Структура готова, полная реализация в разработке
- **Пример работы:**
  ```
  Пользователь:
  1. Вводит email в настройках безопасности
  2. Нажимает "Забыли пароль?"
  
  Система:
  1. Генерирует токен восстановления
  2. Отправляет email с ссылкой
  3. При переходе по ссылке позволяет установить новый пароль
  ```

---

## Этап 2: Сессии и диалоги

### Цель
Организовать структурированные диалоги между пользователем и ИИ для работы с мышлением.

### Функционал

#### 2.1. Создание новой сессии
- **Файл:** `app.py` (route `/api/sessions`, POST), `static/js/app.js` (function `createNewSession`)
- **Цель:** Создать новый диалог для работы с конкретной ситуацией/проблемой
- **Пример работы:**
  ```
  Пользователь:
  1. Нажимает "Новая сессия"
  
  Система:
  1. Создает запись в таблице sessions
  2. Генерирует уникальный session_id
  3. Устанавливает title = "Новая сессия"
  4. Открывает чат с приветственным сообщением
  5. Инициализирует состояние диалога
  ```

#### 2.2. Отправка сообщений
- **Файл:** `app.py` (socket handler `message`), `static/js/app.js` (function `sendMessage`)
- **Цель:** Обработать сообщение пользователя и получить ответ от ИИ
- **Пример работы:**
  ```
  Пользователь пишет: "Я чувствую тревогу перед экзаменом"
  
  Система:
  1. Сохраняет сообщение в таблицу messages
  2. Отправляет в PsychologistAI для обработки
  3. ИИ анализирует эмоцию (тревога) и ситуацию (экзамен)
  4. Генерирует вопрос о мыслях/убеждениях
  5. Отправляет ответ пользователю
  6. Обновляет состояние сессии
  ```

#### 2.3. Обновление названия сессии
- **Файл:** `app.py` (socket handler `update_session_title`), `static/js/app.js`
- **Цель:** Автоматически назвать сессию на основе содержания диалога
- **Пример работы:**
  ```
  После нескольких сообщений:
  Пользователь: "Я чувствую тревогу перед экзаменом"
  ИИ: "Какая мысль вызывает эту тревогу?"
  Пользователь: "Я думаю, что провалюсь"
  
  Система:
  1. Анализирует ключевые слова
  2. Генерирует название: "Тревога перед экзаменом"
  3. Обновляет title в таблице sessions
  4. Отображает новое название в списке сессий
  ```

#### 2.4. Приостановка сессии
- **Файл:** `app.py` (route `/api/sessions/<id>/pause`), `static/js/app.js` (function `pauseSession`)
- **Цель:** Временно остановить сессию с возможностью добавить комментарий
- **Пример работы:**
  ```
  Пользователь:
  1. Нажимает "Приостановить сессию"
  2. Вводит комментарий: "Нужно подумать над ответом"
  
  Система:
  1. Сохраняет комментарий в таблицу session_comments
  2. Устанавливает status = 'paused'
  3. Генерирует краткое резюме сессии
  4. Сохраняет в session_journal
  ```

#### 2.5. Загрузка истории сессии
- **Файл:** `app.py` (route `/api/sessions/<id>`), `static/js/app.js` (function `loadSession`)
- **Цель:** Восстановить полный диалог при открытии сессии
- **Пример работы:**
  ```
  Пользователь:
  1. Выбирает сессию из списка
  
  Система:
  1. Загружает все сообщения из таблицы messages
  2. Восстанавливает состояние диалога
  3. Отображает сообщения в хронологическом порядке
  4. Показывает название сессии
  ```

---

## Этап 3: Нейрокарта (Neurocard)

### Цель
Создать визуальную карту мышления пользователя, отображающую связи между событиями, эмоциями и убеждениями.

### Функционал

#### 3.1. Добавление записи в Нейрокарту
- **Файл:** `app.py` (socket handler `map_message`), `static/js/map.js`, `templates/map.html`
- **Цель:** Структурировать информацию о событии, эмоции и убеждении
- **Пример работы:**
  ```
  Пользователь: "Я чувствую злость, когда начальник критикует мою работу"
  
  Система:
  1. Определяет событие: "Критика начальника"
  2. Определяет эмоцию: "Злость"
  3. Задает вопрос: "Какая мысль или убеждение вызывает эту злость?"
  
  Пользователь: "Я думаю, что я неудачник"
  
  Система:
  1. Сокращает идею через GPT (если длинная)
  2. Сохраняет в таблицу event_map:
     - event: "Критика начальника"
     - emotion: "Злость"
     - idea: "Я неудачник"
  3. Отображает в таблице Нейрокарты
  4. Предлагает добавить еще или закончить
  ```

#### 3.2. Отображение Нейрокарты
- **Файл:** `templates/map.html`, `static/js/map.js`, `app.py` (route `/map`)
- **Цель:** Визуализировать все связи между событиями, эмоциями и убеждениями
- **Пример работы:**
  ```
  Нейрокарта отображает:
  
  | Событие              | Эмоция    | Убеждение          |
  |----------------------|-----------|-------------------|
  | Критика начальника   | Злость    | Я неудачник       |
  | Экзамен              | Тревога   | Я провалюсь       |
  | Свидание             | Страх     | Меня не примут    |
  
  Каждая строка показывает связь между ситуацией, эмоциональной реакцией и лежащим в основе убеждением.
  ```

#### 3.3. Добавление сессии в Нейрокарту
- **Файл:** `app.py` (route `/api/sessions/<id>/add-to-map`), `static/js/app.js`
- **Цель:** Автоматически извлечь структурированную информацию из завершенной сессии
- **Пример работы:**
  ```
  Пользователь:
  1. Завершает сессию
  2. Нажимает "Добавить в Нейрокарту"
  
  Система:
  1. Анализирует все сообщения сессии
  2. Извлекает события, эмоции, убеждения
  3. Создает записи в event_map
  4. Обновляет отображение Нейрокарты
  ```

#### 3.4. Работа с убеждениями
- **Файл:** `app.py` (socket handler `go_to_belief`), `static/js/app.js`
- **Цель:** Углубиться в работу с конкретным убеждением
- **Пример работы:**
  ```
  Пользователь:
  1. Кликает на убеждение "Я неудачник" в Нейрокарте
  
  Система:
  1. Создает новую сессию
  2. Устанавливает контекст: работа с убеждением "Я неудачник"
  3. Начинает диалог для перестройки этого убеждения
  4. Использует техники когнитивной реструктуризации
  ```

---

## Этап 4: Личный кабинет

### Цель
Предоставить пользователю доступ к его данным, настройкам и статистике.

### Функционал

#### 4.1. Журнал сессий
- **Файл:** `app.py` (route `/api/cabinet/journal`), `static/js/cabinet.js`
- **Цель:** Показать историю всех сессий с кратким описанием
- **Пример работы:**
  ```
  Отображается:
  
  | Дата       | Название сессии        | Статус   | Резюме                    |
  |------------|------------------------|----------|---------------------------|
  | 2024-01-15 | Тревога перед экзаменом | Завершена| Работа с убеждением...    |
  | 2024-01-14 | Критика начальника     | Пауза    | Приостановлено для...     |
  ```

#### 4.2. Мысли и убеждения
- **Файл:** `app.py` (route `/api/cabinet/thoughts`), `static/js/cabinet.js`
- **Цель:** Показать все выявленные убеждения и мысли из всех сессий
- **Пример работы:**
  ```
  Отображается список:
  - "Я неудачник" (встречается в 3 сессиях)
  - "Я провалюсь" (встречается в 2 сессиях)
  - "Меня не примут" (встречается в 1 сессии)
  
  Каждое убеждение можно открыть для детального просмотра.
  ```

#### 4.3. Реферальная система
- **Файл:** `app.py` (routes `/api/cabinet/referrals`, `/api/cabinet/transactions`), `static/js/cabinet.js`
- **Цель:** Мотивировать пользователей приглашать друзей
- **Пример работы:**
  ```
  Пользователь:
  1. Получает referral_code: "USER123"
  2. Делится ссылкой: "seee.app/register?ref=USER123"
  
  Система:
  1. При регистрации по ссылке сохраняет referrer_id
  2. Начисляет комиссию при активности реферала
  3. Отображает статистику:
     - Всего рефералов: 5
     - Активных: 3
     - Заработано: 150₽
  ```

#### 4.4. Реквизиты для выплат
- **Файл:** `app.py` (routes `/api/cabinet/payment-details`), `static/js/cabinet.js`
- **Цель:** Собрать данные для выплаты реферальных комиссий
- **Пример работы:**
  ```
  Пользователь:
  1. Выбирает форму оплаты: "Самозанятый"
  2. Вводит ФИО, телефон, дату рождения, ИНН
  
  Система:
  1. Сохраняет данные в таблицу payment_details
  2. При достижении минимальной суммы готовит выплату
  ```

#### 4.5. Настройки языка
- **Файл:** `app.py` (route `/api/cabinet/language`), `static/js/cabinet.js`
- **Цель:** Позволить пользователю выбрать язык интерфейса
- **Пример работы:**
  ```
  Пользователь:
  1. Выбирает "English" в настройках
  2. Нажимает "Сохранить"
  
  Система:
  1. Сохраняет language = 'en' в таблице users
  2. Обновляет session['language']
  3. Перезагружает страницу с новым языком
  ```

---

## Этап 5: Безопасность

### Цель
Обеспечить защиту аккаунта пользователя и его данных.

### Функционал

#### 5.1. Двухфакторная аутентификация (2FA)
- **Файл:** `app.py` (routes `/api/cabinet/security/2fa/*`), `static/js/cabinet.js`
- **Цель:** Добавить дополнительный уровень защиты аккаунта
- **Пример работы:**
  ```
  Пользователь:
  1. Открывает "Безопасность" в личном кабинете
  2. Нажимает "Настроить 2FA"
  
  Система:
  1. Генерирует секретный ключ (TOTP)
  2. Создает QR-код для Google Authenticator
  3. Пользователь сканирует QR-код
  4. Вводит код из приложения для подтверждения
  5. Активирует 2FA
  
  При следующем входе:
  1. Пользователь вводит логин/пароль
  2. Система запрашивает код из Google Authenticator
  3. Пользователь вводит код
  4. Вход разрешен
  ```

#### 5.2. Email для восстановления пароля
- **Файл:** `app.py` (route `/api/cabinet/security/email`)
- **Цель:** Позволить восстановить доступ к аккаунту через email
- **Статус:** Структура готова, полная реализация в разработке
- **Пример работы:**
  ```
  Пользователь:
  1. Вводит email в настройках безопасности
  2. Сохраняет
  
  При забытом пароле:
  1. Нажимает "Забыли пароль?"
  2. Вводит email
  3. Получает письмо со ссылкой восстановления
  4. Переходит по ссылке
  5. Устанавливает новый пароль
  ```

#### 5.3. Контакты поддержки
- **Файл:** `app.py` (route `/api/cabinet/security/support`), `static/js/cabinet.js`
- **Цель:** Предоставить пользователю способ связаться с поддержкой
- **Пример работы:**
  ```
  Пользователь:
  1. Открывает "Безопасность"
  2. Видит кнопку "Связаться с поддержкой"
  3. Нажимает - открывается Telegram: t.me/pavel_gulo
  ```

---

## Этап 6: Обратная связь

### Цель
Собрать информацию от пользователей для улучшения продукта.

### Функционал

#### 6.1. Форма обратной связи
- **Файл:** `app.py` (route `/api/feedback`), `templates/index.html`, `static/js/app.js`
- **Цель:** Получить структурированную обратную связь от пользователей
- **Пример работы:**
  ```
  Пользователь:
  1. Нажимает "Обратная связь"
  2. Заполняет форму:
     - О себе: "Студент, 22 года"
     - Ожидания: "Хотел разобраться с тревогой"
     - Ожидания оправдались: "Да, частично"
     - Как прошло: "Помогло понять свои убеждения"
  3. Отправляет
  
  Система:
  1. Сохраняет в таблицу feedback
  2. Благодарит пользователя
  3. Данные используются для анализа и улучшений
  ```

---

## Этап 7: ИИ обработка (PsychologistAI)

### Цель
Обеспечить интеллектуальную обработку сообщений пользователя и генерацию психологически корректных ответов.

### Функционал

#### 7.1. Анализ эмоций и ситуаций
- **Файл:** `psychologist_ai.py` (class `PsychologistAI`, method `analyze_emotion`)
- **Цель:** Определить эмоцию пользователя и контекст ситуации
- **Пример работы:**
  ```
  Вход: "Я чувствую злость, когда начальник критикует мою работу"
  
  Выход:
  {
    "emotion": "злость",
    "situation": "критика начальника",
    "context": "рабочая ситуация"
  }
  ```

#### 7.2. Генерация ответов
- **Файл:** `psychologist_ai.py` (method `generate_gpt_response`)
- **Цель:** Создать психологически корректный вопрос для работы с убеждениями
- **Пример работы:**
  ```
  Контекст: Пользователь чувствует злость при критике начальника
  
  ИИ генерирует:
  "Какая мысль или убеждение вызывает у вас эту злость в ситуации критики? 
   Что вы думаете о себе в этот момент?"
  
  (НЕ использует некорректные вопросы типа "почему вы себя так чувствуете")
  ```

#### 7.3. Сокращение идей
- **Файл:** `psychologist_ai.py` (method `_shorten_idea`)
- **Цель:** Сделать длинные идеи/убеждения более краткими для Нейрокарты
- **Пример работы:**
  ```
  Вход: "Я думаю, что я полный неудачник, который никогда ничего не достигнет 
         и все мои попытки обречены на провал, потому что я недостаточно хорош"
  
  Выход: "Я неудачник, который ничего не достигнет"
  ```

#### 7.4. Извлечение структурированной информации
- **Файл:** `psychologist_ai.py` (method `extract_structured_info`)
- **Цель:** Извлечь события, эмоции и убеждения из текста
- **Пример работы:**
  ```
  Вход: "Я чувствую тревогу перед экзаменом, потому что думаю, что провалюсь"
  
  Выход:
  {
    "event": "экзамен",
    "emotion": "тревога",
    "idea": "я провалюсь"
  }
  ```

---

## Этап 8: Мобильная версия

### Цель
Обеспечить удобный пользовательский опыт на мобильных устройствах.

### Функционал

#### 8.1. Telegram-стиль интерфейса
- **Файл:** `static/css/style.css`, `templates/index.html`
- **Цель:** Создать знакомый и интуитивный интерфейс
- **Пример работы:**
  ```
  Элементы:
  - Фиксированная строка ввода внизу
  - Круглые кнопки (стрелка вверх, отправка)
  - Гамбургер-меню слева сверху
  - Логотип справа сверху
  - Название сессии по центру
  - Пузырьковые сообщения
  - Меню снизу при нажатии на стрелку
  ```

#### 8.2. Адаптивная верстка
- **Файл:** `static/css/style.css` (media queries)
- **Цель:** Корректное отображение на разных размерах экранов
- **Пример работы:**
  ```
  Десктоп (>768px):
  - Боковая панель всегда видна
  - Широкие поля ввода
  - Полная навигация
  
  Мобильный (<768px):
  - Боковая панель скрыта (открывается по клику)
  - Компактные элементы
  - Фиксированная строка ввода
  - Мобильное меню
  ```

#### 8.3. Темная тема
- **Файл:** `static/css/style.css` (body.dark-mode), `static/js/app.js`
- **Цель:** Предоставить выбор темы оформления
- **Пример работы:**
  ```
  Пользователь:
  1. Открывает мобильное меню
  2. Переключает "Тёмный режим"
  
  Система:
  1. Применяет темные цвета
  2. Сохраняет выбор в localStorage
  3. Применяет при следующем визите
  ```

---

## Этап 9: База данных

### Цель
Хранить все данные пользователей и сессий.

### Структура таблиц

#### 9.1. users
- **Поля:** id, username, password_hash, referral_code, user_id, language, google_id, email, full_name, two_factor_secret, two_factor_enabled
- **Цель:** Хранить информацию о пользователях
- **Пример записи:**
  ```sql
  id: 1
  username: "user123"
  password_hash: "$2b$12$..."
  referral_code: "USER123"
  language: "ru"
  google_id: NULL
  email: "user@example.com"
  ```

#### 9.2. sessions
- **Поля:** id, user_id, title, created_at, status
- **Цель:** Хранить информацию о сессиях
- **Пример записи:**
  ```sql
  id: 5
  user_id: 1
  title: "Тревога перед экзаменом"
  created_at: "2024-01-15 10:30:00"
  status: "active"
  ```

#### 9.3. messages
- **Поля:** id, session_id, role, content, created_at
- **Цель:** Хранить все сообщения в сессиях
- **Пример записи:**
  ```sql
  id: 100
  session_id: 5
  role: "user"
  content: "Я чувствую тревогу перед экзаменом"
  created_at: "2024-01-15 10:31:00"
  ```

#### 9.4. event_map
- **Поля:** id, user_id, event, emotion, idea, is_completed, created_at
- **Цель:** Хранить структурированные данные для Нейрокарты
- **Пример записи:**
  ```sql
  id: 3
  user_id: 1
  event: "Экзамен"
  emotion: "Тревога"
  idea: "Я провалюсь"
  is_completed: 0
  created_at: "2024-01-15 11:00:00"
  ```

#### 9.5. feedback
- **Поля:** id, user_id, about_self, expectations, expectations_met, how_it_went, created_at
- **Цель:** Хранить обратную связь от пользователей
- **Пример записи:**
  ```sql
  id: 2
  user_id: 1
  about_self: "Студент, 22 года"
  expectations: "Хотел разобраться с тревогой"
  expectations_met: "Да, частично"
  how_it_went: "Помогло понять свои убеждения"
  created_at: "2024-01-15 12:00:00"
  ```

---

## Этап 10: Развертывание

### Цель
Обеспечить доступность приложения для пользователей.

### Функционал

#### 10.1. Railway deployment
- **Файлы:** `railway.json`, `Procfile`, `requirements.txt`, `runtime.txt`
- **Цель:** Автоматическое развертывание на Railway
- **Пример работы:**
  ```
  1. Код в GitHub
  2. Railway подключается к репозиторию
  3. Автоматически определяет Python приложение
  4. Устанавливает зависимости из requirements.txt
  5. Запускает через Procfile
  6. Использует переменные окружения (DATABASE_URL, OPENAI_API_KEY, SECRET_KEY)
  7. Приложение доступно по URL
  ```

#### 10.2. PostgreSQL интеграция
- **Файл:** `app.py` (function `get_db`)
- **Цель:** Использовать PostgreSQL в production вместо SQLite
- **Пример работы:**
  ```
  Локально (development):
  - Использует SQLite: psychologist.db
  
  На Railway (production):
  - Использует PostgreSQL из DATABASE_URL
  - Автоматические миграции при запуске
  ```

---

## Технический стек

- **Backend:** Flask, Flask-SocketIO, SQLite/PostgreSQL
- **Frontend:** HTML, CSS, JavaScript (vanilla)
- **AI:** OpenAI GPT API
- **Authentication:** Google OAuth, bcrypt для паролей
- **2FA:** pyotp, qrcode
- **Deployment:** Railway, GitHub
- **Database:** SQLite (dev), PostgreSQL (prod)

---

## Принципы работы

1. **Архитектура мышления:** Основана на структуре мышления сильного ИИ
2. **Когнитивная реструктуризация:** Помощь в изменении деструктивных убеждений
3. **Визуализация:** Нейрокарта показывает связи между событиями, эмоциями и мыслями
4. **Безопасность:** 2FA, хеширование паролей, защищенные сессии
5. **Удобство:** Мобильная версия, темная тема, мультиязычность

---

## Будущие улучшения

1. Полная реализация восстановления пароля через email
2. Расширенная аналитика для пользователей
3. Экспорт Нейрокарты в различные форматы
4. Интеграция с календарем для напоминаний
5. Групповые сессии
6. Интеграция с другими платформами


